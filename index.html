<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo con Slider</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

<div class="max-w-6xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Catálogo de Productos</h1>
  <div id="productos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQKlAxnSIcEhnhq6R4o7gtrqS8AgQ98XD5RQmu_sC5XaFmb5T_Vi8X9qramRm-6ndphgRzcMPUOy1fV/pub?gid=964983527&single=true&output=csv";

async function cargarProductos() {
  const res = await fetch(sheetUrl);
  const data = await res.text();
  const filas = data.trim().split('\n').map(f => f.split(','));
  const headers = filas[0];
  const body = filas.slice(1);

  const productos = body.map(row => {
    const obj = {};
    headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim());
    return obj;
  });

  const agrupados = {};
  productos.forEach(p => {
    const key = `${p["Producto"]}-${p["Sexo"]}-${p["Colección"]}`;
    if (!agrupados[key]) agrupados[key] = { ...p, tallas: [], imagenes: [] };
    agrupados[key].tallas.push({
      tallaLetra: p["Talla en letras"],
      tallaNum: p["Talla en número"],
      color: p["Color"],
      precio: p["PV_Minorista"]
    });
    agrupados[key].imagenes = [p["Imagen 1"], p["Imagen 2"], p["Imagen 3"]].filter(Boolean);
  });

  mostrarProductos(Object.values(agrupados));
}

function mostrarProductos(productos) {
  const contenedor = document.getElementById('productos');
  contenedor.innerHTML = '';

  productos.forEach((p, i) => {
    const imagenesHtml = p.imagenes.map((url, idx) => `
      <img src="${url}" class="w-full h-60 object-contain ${idx === 0 ? '' : 'hidden'}" data-index="${idx}">
    `).join('');

    const dots = p.imagenes.map((_, idx) => `
      <button class="h-2 w-2 rounded-full ${idx === 0 ? 'bg-gray-800' : 'bg-gray-400'}" onclick="mostrarSlide(${i}, ${idx})"></button>
    `).join('');

    const tallasHTML = p.tallas.map(t => `
      <tr>
        <td class='border px-2 py-1'>${t.tallaLetra} (${t.tallaNum})</td>
        <td class='border px-2 py-1'>${t.color}</td>
        <td class='border px-2 py-1'>S/ ${t.precio}</td>
      </tr>`).join('');

    const card = document.createElement('div');
    card.className = "bg-white rounded shadow p-4";
    card.innerHTML = `
      <div class="relative">
        <div id="slider-${i}" class="w-full overflow-hidden rounded mb-3">
          ${imagenesHtml}
        </div>
        <div class="flex justify-center gap-2 mb-2">${dots}</div>
      </div>
      <button onclick="toggleDetalle(${i})" class="text-xl font-bold mb-2 text-left w-full hover:underline">${p["Producto"]}</button>
      <div class="text-sm">
        <p class="mb-1">Sexo: ${p["Sexo"]}</p>
        <p class="mb-1">Sección: ${p["Colección"]}</p>
        <div id="detalle-${i}" class="hidden">
          <table class='w-full text-xs mt-2'>
            <thead>
              <tr class='bg-gray-100'>
                <th class='text-left px-2 py-1 border'>Talla</th>
                <th class='text-left px-2 py-1 border'>Color</th>
                <th class='text-left px-2 py-1 border'>Precio</th>
              </tr>
            </thead>
            <tbody>${tallasHTML}</tbody>
          </table>
        </div>
        <a target="_blank" href="https://wa.me/51986475803?text=Hola, estoy interesada en ${encodeURIComponent(p["Producto"])}"
           class="inline-block mt-3 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
          Consultar por WhatsApp
        </a>
      </div>
    `;
    contenedor.appendChild(card);
  });
}

function mostrarSlide(prodIndex, imgIndex) {
  const slider = document.querySelector(`#slider-${prodIndex}`);
  const imgs = slider.querySelectorAll('img');
  imgs.forEach((img, idx) => {
    img.classList.toggle('hidden', idx !== imgIndex);
  });

  const dots = slider.parentElement.querySelectorAll('button');
  dots.forEach((dot, idx) => {
    dot.className = `h-2 w-2 rounded-full ${idx === imgIndex ? 'bg-gray-800' : 'bg-gray-400'}`;
  });
}

function toggleDetalle(indice) {
  document.querySelectorAll('[id^="detalle-"]').forEach((el, idx) => {
    el.classList.toggle('hidden', idx !== indice || el.classList.contains('hidden'));
  });
}

cargarProductos();
</script>

</body>
</html>
